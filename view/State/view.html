{% extends 'layout.html' %}

{% block title %}État des services{% endblock %}

{% block content %}
<div class="pane ui-layout-center">
  <div class="container">
  {% include 'partial/message.html' %}

    <div class="row">
      <div class="span12">

      </div>

      <div class="span4">
        <h2 class="{{ avglevel(zabbix, config)}}">Serveurs {% if isAdmin() %}<small>Zabbix</small>{% endif %}</h2>
        <ul>
          {% for z in zabbix %}
            <li class="{{ level(z) }}">
              {% if z.name == '' %}
                {{ z.hostname }} -- {{ z.itemname }}
              {% else %}
                {{ z.name }}
              {% endif %}
            </li>
              {% if isAdmin() %}
                <ul>
                  <li>lastvalue: {{ z.lastvalue|number_format(2, ',', ' ')}}</li>
                  <li>prevvalue: {{ z.prevvalue|number_format(2, ',', ' ') }}</li>
                  <li>warning/alert: {{ z.warning ~ '/' ~ z.alert}}</li>
                  <li>
                      <a href="/state/del/{{ z.id }}" onclick="return confirm_delete()"><i class="icon-trash"></i></a>
                      <a href="/state/update/{{ z.id }}"><i class="icon-wrench"></i></a>
                  </li>
                </ul>
              {% endif %}
          {% endfor %}
        </ul>
      </div>

      <div class="span4">
        <h2 class="{{ avglevel(snmp, config)}}">Accès Internet {% if isAdmin() %}<small>SNMP</small>{% endif %}</h2>
        <ul>
          {% for s in snmp %}
            <li class="{{ snmplevel(s) }}">{{ s.name }}</li>
              {% if isAdmin() %}
                <ul>
                  <li>IP: {{ s.ip }}</li>
                  <li>value (b/s): {{ s.value|number_format(0, ',', ' ') }}</li>
                  <li>warning/alert (Mb/s): {{ s.warning ~ '/' ~ s.alert}}</li>
                  <li>
                      <a href="/snmp/del/{{ s.id }}" onclick="return confirm_delete()"><i class="icon-trash"></i></a>
                      <a href="/snmp/update/{{ s.id }}"><i class="icon-wrench"></i></a>
                  </li>
                </ul>
              {% endif %}
          {% endfor %}
        </ul>
      </div>

      <div class="span4">
        <h2>Tickets {% if isAdmin() %}<small>GLPI</small>{% endif %}</h2>
        <table class="table table-bordered">
            <tr >
                <th>Mois</th>
                <th>Total</th>
                <th>En attente</th>
                <th>Assigné</th>
            </tr>
        {% for g in glpi %}
          <tr class="{{ levelGlpi(g) }}">
            <td>{{ g.month }}</td>
            <td>{{ g.total }}</td>
            <td>{{ g.waiting }}</td>
            <td>{{ g.assign }}</td>
          </tr>
        {% endfor %}
        </table>
      </div>
    </div>

  {% if isAdmin() %}
    <div class="span12">
      <a href="/state/add"><button class="btn btn-success">Ajout de règles</button></a>
    </div>
  {% endif %}

    </div>
</div>
{% endblock %}